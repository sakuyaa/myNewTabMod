{"name":"myNewTabMod","tagline":"修改myNewTab这个扩展，使其在火狐41上实现新标签页和扩展签名","body":"# myNewTabMod by sakuyaa\r\n\r\n首先感谢一下原作者`defpt`和`ywzhaiqi`:clap:，\r\n这个扩展是根据[myNewTab](http://bbs.kafan.cn/thread-1759418-1-1.html)这个扩展修改而成的\r\n\r\n## 主要的不同之处\r\n1. 实现火狐41上设置为新标签页\r\n* 将参数存放在火狐preferences里面\r\n* 将导航配置、壁纸等可能有改动的文件设置在profile文件夹内，实现扩展签名\r\n* 扩展重装后不会覆盖配置\r\n* 替换日历算法为我自己编写的算法，从而准确显示父亲节:man:、母亲节:woman:这样的节日\r\n* 神秘的代码:underage:\r\n\r\n## 可能造成不便的地方\r\n1. 存放导航网址的数据文件data.txt中，为网址指定本地图标文件时需要以斜杠`/`开头\r\n* 我写的农历算法由于是使用公式自动计算的缘故，可能会出现一些错误：\r\n\t* 2011年11月23日的小雪应在22日\r\n\t* 2015年8月14日-9月12日农历七月出错\r\n* Bing壁纸的命名还是采取日期+壁纸的信息，不会自动删除，需要注意壁纸会一直累积下去\r\n* 默认的导航网址中有返利链接\r\n* 在火狐配置文件目录里的扩展数据文件夹中的style.css文件并不会随着扩展更新而更新，请自行从扩展目录的myNewTabMod文件夹中替换\r\n\r\n## 扩展图文\r\n* 扩展主界面，左上角的天气可以在附加组件管理器中该扩展选项界面设置其URL\r\n\t国历和农历日期会以不同颜色显示当天的节假日和节气信息\r\n![](https://raw.githubusercontent.com/sakuyaa/myNewTabMod/master/pic/main.png \"主界面\")\r\n* 参数设置  \r\n![](https://raw.githubusercontent.com/sakuyaa/myNewTabMod/master/pic/config.png \"参数设置\")\r\n* 将参数存放在火狐preferences里面  \r\n![](https://raw.githubusercontent.com/sakuyaa/myNewTabMod/master/pic/prefs.png \"首选项\")\r\n* 储存的Bing壁纸  \r\n![](https://raw.githubusercontent.com/sakuyaa/myNewTabMod/master/pic/bingImg.png \"Bing图片\")\r\n\r\n## 尚未解决（能力有限…）\r\n* 通过扩展选项选择“背景图片地址”时，文件路径包含中文会造成乱码（已修复，但会造成选择文件后无法直接显示文件路径）\r\n\r\n##### 另一种实现方式：\r\n在`options.xul`中，添加以下代码：\r\n```xml\r\n<setting type=\"control\" title=\"背景图片地址\">\r\n\t<button id=\"setbackgroundimage\" label=\"浏览...\" />\r\n</setting>\r\n<setting pref=\"extensions.myNewTabMod.backgroundImage\" type=\"string\" title=\"背景图片地址\" id=\"backgroundimage\" />\r\n```\r\n在`bootstrap.js`中，添加以下代码：\r\n```js\r\nvar myNewTabMod = {\r\n\tobserver: {\r\n\t\tobserve: function(aSubject, aTopic, aData) {\r\n\t\t\tif (aTopic == 'addon-options-displayed' && aData == 'mynewtabmod@sakuyaa') {\r\n\t\t\t\tvar path;\r\n\t\t\t\ttry {\r\n\t\t\t\t\tpath = Services.prefs.getComplexValue('extensions.myNewTabMod.path', Ci.nsISupportsString).toString();\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tpath = 'myNewTabMod';\r\n\t\t\t\t}\r\n\t\t\t\taSubject.getElementById('backgroundimage').value = path;\r\n\t\t\t\taSubject.getElementById('setbackgroundimage').onclick = function() {\r\n\t\t\t\t\tvar fp = Cc['@mozilla.org/filepicker;1'].createInstance(Ci.nsIFilePicker);\r\n\t\t\t\t\tfp.init(window, '设置背景图片', fp.modeOpen);\r\n\t\t\t\t\tfp.appendFilters(fp.filterImages);\r\n\t\t\t\t\tif (fp.show() == fp.returnCancel || !fp.file) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar str = Cc['@mozilla.org/supports-string;1'].createInstance(Ci.nsISupportsString);\r\n\t\t\t\t\tstr.data = Services.io.newFileURI(fp.file).spec;\r\n\t\t\t\t\taSubject.getElementById('backgroundimage').value = str.data;\r\n\t\t\t\t\tmyNewTabMod.prefs.setComplexValue('backgroundImage', Ci.nsISupportsString, str);\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\nvar startup = function(data, reason) {\r\n\tServices.obs.addObserver(myNewTabMod.observer, 'addon-options-displayed', false);\r\n};\r\nvar shutdown = function(data, reason) {\r\n\tServices.obs.removeObserver(myNewTabMod.observer, 'addon-options-displayed');\r\n};\r\n```\r\n然而，由于无法获取到选项界面的**window**，使得**fp.init(window, '设置背景图片', fp.modeOpen);**这个函数无法执行。","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}